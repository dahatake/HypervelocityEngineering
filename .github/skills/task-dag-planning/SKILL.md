---
name: task-dag-planning
description: "AGENTS.mdの『計画（DAG）+見積+15分分割』を実行するための詳細手順。plan.md / subissues.md を作るときに使う。"
---

# task-dag-planning

## 目的
- AGENTS.md の要求どおり、DAG（依存関係）で分解し、分単位の見積と分割判断を行う。

## 手順
1) AC（受け入れ条件）と非対象を箇条書きで固定（テスト可能な表現に寄せる）
2) 最小棚卸し（対象一覧 / 根拠 / 検証手段）
3) DAG作成（ノード=レビュー可能な成果物）
4) 各ノードに以下を付与
- 成果物 / 参照元（根拠）/ 変更候補パス / 検証 / 見積（R+P+I+V+F）/ 不確実性（低中高）

4.5) **見積合計の計算（省略不可）**

   各ノードの見積を合計し、以下のフォーマットで plan.md に記載する:

   | ノード | 見積（分） |
   |--------|-----------|
   | Step A | X |
   | Step B | Y |
   | **合計** | **Z** |

   Z分 > 15分 → **SPLIT_REQUIRED**
   Z分 ≤ 15分 → **PROCEED**（不確実性が低の場合）

   **合計行の直後に、15分との比較結果を必ず1行書くこと。**

5) **分割判定（AGENTS.md §2.2 に従い、機械的に実行）**

   a) 全ノードの見積合計を計算する
   b) plan.md の `## 分割判定` セクションに見積合計を記載する
   c) 以下を判定する:

   **合計 > 15分 の場合:**
   - `判定結果: SPLIT_REQUIRED` と記載
   - subissues.md を作成する（各Sub ≤ 15分）
   - 実装ファイル（.sh, .py, .ts, .js 等）は一切作成しない
   - PR タイトルに `[WIP]` を付与
   - 作業はここで終了

   **合計 ≤ 15分 かつ 不確実性が低 の場合:**
   - `判定結果: PROCEED` と記載
   - 実装に進んでよい

   **注意（過去の誤判断事例）**:
   ❌ 誤り: 見積33分で「→ 分割不要（1バッチで実行可能）」と記載し、全実装を1PRで行った
   ✅ 正しい: 見積33分 > 15分 → SPLIT_REQUIRED。subissues.md を作成し、実装は Sub Issue 経由の別PRで行う

## plan.md の最小フォーマット
- 概要（目的/非対象/根拠）
- AC（チェックボックス）
- DAG（ノード一覧と依存）
- 見積合計と分割判定
- 検証計画
- 次に実装するSub（1つ）

## subissues.md の最小フォーマット（Subごと）
- Title
- 背景（1〜3行）
- AC（チェックボックス）
- 根拠（パス/箇所）
- 変更候補パス
- 検証
- 見積（<=15）/ 不確実性 / 依存
