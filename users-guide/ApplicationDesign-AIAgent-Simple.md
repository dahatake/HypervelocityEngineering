# AI Agent 設計 - 汎用 Agent（LLM + Tool + RAG）Quick作成

プロトタイピングのフェーズあるいはMVPの最初のフェーズでの利用を想定しています。


# ツール

AI Agentの実装は、Microsoft 365 CopilotのChatでの、Agent Builderや、Microsoft Copilot Studio。あるいは、Microsoft Foundryでなどがお勧めです。

Promptは、**Microsoft 365 Copilot Chat**で入力をしてください。

- モデルはGPT-5.2 Thinkingがおススメです。
- このStepは1つのチャットの中での一連の会話で行うことをお勧めします。

Microsoft 365 Copilot Chat:

  https://m365.cloud.microsoft/chat

# Step 1. AI Agentのリストアップ

要求定義書などの任意のドキュメントを添付したうえで、以下のPromptを実行します。

Prompt:

```text
あなたはエンタープライズ向けAIエージェント開発の「シニアアーキテクト」です。目的は、添付（または貼り付け）の要求定義書に基づき、顧客のユースケースを実現するAI Agent候補を、根拠付きで過不足なく設計提案することです。

############################
# 入力
############################
- 要求定義書（ユースケースなどを含む）

############################
# 重要ルール（厳守）
############################
- 要求定義書に根拠がない「データ」「API」「システム名」「数値」「運用手順」を想像で作らないこと。
- 文書に記載がない場合は、該当欄に必ず「要確認」または「該当なし」と明記する（推測で補完しない）。
- スコープ逸脱禁止：要求定義書のユースケースに直接紐づかないAI Agent（便利機能・追加提案・将来案の膨張）は出さない。
- 文章は簡潔で具体的に。長い前置きや雑談は不要。必要なら表を使って比較可能にする。
- 該当する候補が本当に無い場合は、候補表に「該当なし」と1行だけ出す。

############################
# 進め方（ステップ）
############################
Step 1) 要求定義書を読み、今回の提案に関係する情報だけを抽出して整理する：
- ユースケース一覧（ID/名称/目的/主要アクター/成功条件）
- 入出力データ（データ種別、所在、更新頻度、機密度が書かれていれば）
- 既存システム/ツール/API（名称、責務、連携点が書かれていれば）
- 制約（法務/セキュリティ/ネットワーク/権限/言語/SLA/コストなど）
- 非機能（監査、ログ、説明責任、可用性、運用体制など）
※この整理は「箇条書き」で短く。

Step 2) ユースケースに直接対応するAI Agent候補を設計する。
- 1ユースケースに複数Agentが必要なら分割してよいが、最小構成を優先する。
- 逆に、1つのAgentで複数ユースケースをまとめられるなら統合してよい（理由を明記）。

Step 3) 最終出力の直前に、自己点検を1回だけ行う：
- 根拠のない断定がないか
- 「要確認/該当なし」を入れるべき箇所を入れているか
- ユースケースとの紐づきが全候補にあるか

############################
# 出力形式（必ずこの形）
############################
A. ユースケースと前提の要約（短く）
- ユースケース要約：最大10行
- 主要制約：最大8行
- 不明点（文書から確定できない点）：最大8行（推測せず列挙）

B. AI Agent候補一覧
以下の列を文章で出力すること：
- Agent名称
- 役割（何を自動化/支援するかを1〜2文で）
- できること・権限
- 対応ユースケース（IDや章番号など、文書上の参照をできるだけ付ける）
- 参照すべきデータ（データ名/所在/形式が書かれていれば。無ければ「要確認」）
- 呼び出すAPI・連携先（API名/システム名。無ければ「要確認」）
- 入出力（入力→処理→出力を箇条書きで簡潔に）
- リストアップした理由（ユースケース達成への因果を具体的に。できれば「なぜ単独Agentが必要か/統合できないか」も）

C. 補足（任意だが有用なら）
- ユースケースとAI Agentの候補間の依存関係。Mermaid記法で作成（あれば）
- 実装の優先順位（高/中/低）と理由（ユースケース価値・難易度・リスクに基づく）
※ここでもスコープ逸脱は禁止。要件に紐づく範囲のみ。
```

# Step 2. AI Agentの関連性の図式化

複数のAI Agentが提示されることが多いです。それぞれのAI Agentの関連性を、図式化します。

Prompt:

``` text
ユーザー起点のエージェント呼び出しフローを Mermaid 記法で可視化してください。

# 入力
- エージェント一覧（名前 / 役割 / できること・権限 / 入出力）
- ユーザーが実行したい1回のタスク概要（目的、期待成果物、制約）
- 可能なら：エラー時の扱い（リトライ/人手介入/中断条件）

# 不足情報の扱い（重要）
- エージェント名・役割・呼び出し条件が不足していて正確な図が描けない場合は、先に「最大3つ」だけ確認質問をしてください。
- 推測でエージェントや機能を捏造しないでください。

# 作成する図の要件
- Mermaid は必ず sequenceDiagram を使う（ユーザー→Agent→Agent の呼び出し/戻りをメッセージで表現する）。
- フローは必ずユーザー起点で開始する。
- 「単一Agentだけで完結するケース」と「複数Agentを呼び出すケース」を alt 分岐で必ず表現する（必ずしもマルチエージェントではないことを図に反映）。
- 複数Agentの場合：
  - どの条件で他Agentを呼ぶのか（判断ポイント）をメッセージまたはノートで明示
  - 受け渡す成果物（例：要件、ドラフト、検証結果、最終成果物）をメッセージで明示
- 例外系（最低1つ）を opt または alt で表現する（例：失敗→リトライ、権限不足→ユーザー確認、など）。
- 余計なエージェント追加、余計な機能提案、長い解説は禁止。図に必要な最小限のみ。

# 出力形式（厳守）
- 出力は Mermaid コードブロックと（```mermaid ... ```）、詳細な説明の文章を作成する。

```

# Step 3. System Promptの作成

それぞれのAI Agent用の System Promptのドラフトを作成します。
数が多い場合は、適時作成する量を減らしてください。

Prompt:

````text
あなたは「AI Agent設計者」です。以下のAI Agent候補一覧（AGENT_LIST）を入力として、各Agentごとに“個別に最適化したSystem Prompt”を作成し、あわせて候補一覧の要約（指定列）も出力してください。

# 重要要件（必ず順守）
- 推測で事実を作らない。AGENT_LISTや参照情報に無い事項は必ず「要確認」と明記する。
- 可能なら、System Prompt作成のベストプラクティスをWebで確認し、根拠を反映する。
  - ただしWeb検索や外部参照が利用できない場合は、その旨を明記したうえで、一般に受け入れられたプロンプト設計原則（明確な役割/制約/出力形式/不足情報の質問/安全配慮）で代替し、断定しない。
- スコープ逸脱禁止：ユーザー要求（このPromptの要件）に無い追加機能・追加成果物・勝手な前提を作らない。
- 対象ユーザーはPrompt初心者。各AgentのSystem Promptには「複数回の会話で小さなタスクに分割して進める」ための会話運用（質問→提案→確認→実行→要約）を必ず組み込む。
- 作成後に必ず見直しを行い、(1)欠損の扱い、(2)権限逸脱、(3)曖昧さ、(4)出力形式崩れ を修正してから最終出力する。

# 出力言語
- 日本語

# 出力フォーマット（厳守：この順序・見出しで出す）

## 1) System Prompt集
各Agentごとに以下の形で出す。System Promptは必ずコードブロックで囲む。

### Agent: <Agent名称>
```system
<ここにSystem Prompt>
```

# System Promptに必ず含める内容（各Agent共通の骨格）

System Promptは、少なくとも次を含むこと（Agentの内容に合わせて具体化する）：

1. 役割と目的（何を達成するAgentか、何をしないか）
2. 権限と制約（アクセスできるデータ/できない操作/安全・法令・秘密情報の扱い）
3. 入力が不足している場合の動き（最初に確認する質問を“最大3つまで”／不明点は「要確認」）
4. 初心者向けの会話運用（小さなタスク分割）

   * 例：最初に「目的確認」→次に「選択肢を2〜4個提示」→ユーザー選択→実行→短い要約→次の一手提案
5. 出力の形（箇条書き中心、必要ならテンプレを提示、冗長にしない）
6. 品質チェック（最終出力前に、矛盾/抜け/権限逸脱/不明点の明示を自己点検して修正）

````